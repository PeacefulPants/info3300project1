<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="main.js" type="text/javascript"></script>
    <style>
      .grid line {
            stroke: lightgrey;
            stroke-opacity: 0.7;
            shape-rendering: crispEdges;
        }


      .spinner circle {
        fill: none;
        stroke: #000000;
        stroke-width: 1.5px;
        stroke-dasharray: 283;
      }
     /* UI styling */
     h1,h2, h3 {
        text-align: center;
     }
      p{
        color:darkgray;
        margin-bottom: 10mm;
        text-align: center;
     }
      

    </style>
  </head>

  <body>
    <div id = "header">
    <h1> Console Video Game sales from 1980 - 2020</h1>
    <h3>Info 3300 project 1</h3>
    </div>
    <br>
    <br>
    <div id="visuals">
        <div id="barChart">
            <h2>Graph 1: Sales by Year for the three most popular console companies</h2>
            <p>This bar graph visualization offers a numerial analysis of the number of sales from the three major video game
            companies: Nintendo, Sony, and Mircosoft by each year.</p>
            <script>
                const margin = { top: 20, right: 20, bottom: 70, left: 40 },
                    width = 1500 - margin.left - margin.right,
                    height = 450 - margin.top - margin.bottom;
    
                const x = d3.scaleBand().rangeRound([0, width], .05).padding(0.4),
                    y = d3.scaleLinear().range([height, 0]);
    
                const xAxis = d3.axisBottom(x),
                    yAxis = d3.axisLeft(y).ticks(10);
    
                const svg = d3.select("#barChart")
                    .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
    
                // Define platforms
                const nintendoPlatforms = [
                    'Wii', 'GB', '3DS', 'DS', 'GameCube', 'SNES', 'NES', 'GBA', '3DS', 'N64', 'WiiU', 'GC'
                ];
                const sonyPlatforms = ["PS3", "PS2", "PS4", "PS", "PSP", "PSV", "PSX"];
                const microsoftPlatforms = ["X360", "XB", "XOne"];
    
                // Load data
                d3.csv("vgsales_clean.csv").then(data => {
                    let salesData = {};
    
                    data.forEach(d => {
                        d.Year = +d.Year;
                        d.Global_Sales = +d.Global_Sales;
    
                        if (!salesData[d.Year]) {
                            salesData[d.Year] = {Nintendo: 0, Sony: 0, Microsoft: 0};
                        }
    
                        if (nintendoPlatforms.includes(d.Platform)) {
                            salesData[d.Year].Nintendo += d.Global_Sales;
                        } else if (sonyPlatforms.includes(d.Platform)) {
                            salesData[d.Year].Sony += d.Global_Sales;
                        } else if (microsoftPlatforms.includes(d.Platform)) {
                            salesData[d.Year].Microsoft += d.Global_Sales;
                        }
                    });
    
                    let aggregatedData = [];
                    for (let year in salesData) {
                        aggregatedData.push({
                            Year: year,
                            Nintendo: salesData[year].Nintendo,
                            Sony: salesData[year].Sony,
                            Microsoft: salesData[year].Microsoft
                        });
                    }
    
                    x.domain(aggregatedData.map(d => d.Year));
                    y.domain([0, 350]);
    
                    const colors = {
                        Nintendo: 'salmon',      
                        Sony: 'lightblue',      
                        Microsoft: 'lightgreen' 
                    };
    
                    ['Nintendo', 'Sony', 'Microsoft'].forEach((company, idx) => {
                        svg.selectAll(`.bar-${company}`)
                            .data(aggregatedData)
                            .enter().append("rect")
                            .attr("class", `bar-${company}`)
                            .style("fill", colors[company])
                            .attr("x", d => x(d.Year) + x.bandwidth() / 3 * idx)
                            .attr("width", x.bandwidth() / 3)
                            .attr("y", d => y(d[company]))
                            .attr("height", d => height - y(d[company]));
                    });
    
                    // Axes
                    svg.append("g")
                        .attr("class", "x axis")
                        .attr("transform", "translate(0," + height + ")")
                        .call(xAxis)
                        .selectAll("text")
                        .style("text-anchor", "middle")
                        .attr("dy", ".55em");
    
                    svg.append("g")
                        .attr("class", "y axis")
                        .call(yAxis)
                        .append("text")
                        .attr("transform", "rotate(-90)")
                        .attr("y", 6)
                        .attr("dy", ".71em")
                        .style("text-anchor", "end")
                        .text("Global Sales");
    
    
                    //labels
                    svg.append("text")             
                        .attr("transform", "translate(" + (width/2) + " ," + (height + margin.bottom - 10) + ")")
                        .style("text-anchor", "middle")
                        .text("Year");
                    
                    svg.append("text")
                        .attr("transform", "rotate(-90)")
                        .attr("y", -6 - margin.left)
                        .attr("x", 0 - (height / 2))
                        .attr("dy", "1em")
                        .style("text-anchor", "middle")
                        .text("Sales");
    
                    //legend
                    const legendEntries = [
                        { label: 'Nintendo', color: 'salmon' },
                        { label: 'Sony', color: 'lightblue' },
                        { label: 'Microsoft', color: 'lightgreen' }
                        ];
    
                    const legend = svg.selectAll(".legend")
                        .data(legendEntries)
                        .enter()
                        .append("g")
                        .attr("class", "legend")
                        .attr("transform", function(d, i) {
                            return "translate(0," + i * 20 + ")";
                        });
    
                    // draw legend colored rectangles
                    legend.append("rect")
                        .attr("x", width )
                        .attr("width", 18)
                        .attr("height", 18)
                        .style("fill", d => d.color);
    
                    //  legend text
                    legend.append("text")
                        .attr("x", width - 4)
                        .attr("y", 9)
                        .attr("dy", ".35em")
                        .style("text-anchor", "end")
                        .text(d => d.label);

                    // y axis grid line
                    svg.append("g")         
                        .attr("class", "grid")
                        .call(d3.axisLeft(y)
                            .ticks(10)
                            .tickSize(-width+ 70)
                            .tickFormat("")
                        )
                         
                        
                        
    
    
                });
            </script>
          </div>


          
      <br>   
      <div id = "scatterplot">
        <h2>Graph 2: Break down visualization of Sales by Year for each console company</h2>
        <p>These scatterplot visualization offers a in depth understanding of the number of sales from each video game
        companies: Nintendo, Sony, and Mircosoft by each year.</p>
        <script>
            csvFile = "vgsales_clean.csv";

            d3.csv(csvFile).then(function (data) {
            const cleaned = preprocess(data);
            console.log(cleaned);
            const nintendoPlatforms = [
            'Wii', 
            'GB',
            '3DS', 
            'DS', 
            'GameCube', 
            'SNES', 
            'NES', 
            'GBA',
            '3DS', 
            'N64',
            'WiiU',
            'GC',
            ];
            const sonyPlatforms = [
                "PS3",
                "PS2",
                "PS4",
                "PS",
                "PSP",
                "PSV",
                "PSX",
            ];
            const microsoftPlatforms = ["X360", "XB", "XOne"];

            // filter data based on platforms
            const nintendoData = data.filter((d) =>
                nintendoPlatforms.includes(d.Platform)
            );
            const sonyData = data.filter((d) =>
                sonyPlatforms.includes(d.Platform)
            );
            const microsoftData = data.filter((d) =>
                microsoftPlatforms.includes(d.Platform)
            );

            // create a function to draw scatterplot
            function drawScatterPlot(data, companyId) {
                const width = 600;
                const height = 400;

                let svgContainer = d3.select("#visuals");
                let svg = svgContainer
                .append("svg")
                .attr("id", companyId)
                .attr("width", width)
                .attr("height", height);

                let margin = { top: 50, right: 30, bottom: 50, left: 60 };

                let xScale = d3
                .scaleLinear()
                .domain([1980, 2020])
                .range([margin.left, width - margin.right]);
                let yScale = d3
                .scaleLinear()
                .domain([0, d3.max(data, (d) => Number(d.Global_Sales))])
                .range([height - margin.bottom, margin.top]);

                // Color based on company
                let color;
                switch (companyId) {
                case "Nintendo":
                    color = "#FFC8D0";
                    break;
                case "Sony":
                    color = "#B2D8E0";
                    break;
                case "Microsoft":
                    color = "#98FB98";
                    break;
                }

                svg
                .selectAll("circle")
                .data(data)
                .join("circle")
                .attr("cx", (d) => xScale(+d.Year))
                .attr("cy", (d) => yScale(d.Global_Sales))
                .attr("r", (d) => 3)
                .style("fill", color);

                // axis
                svg
                .append("g")
                .call(d3.axisLeft(yScale))
                .attr("transform", `translate(${margin.left},0)`);

                svg
                .append("g")
                .call(d3.axisBottom(xScale).tickFormat((d) => `${d}`))
                .attr("transform", `translate(0,${height - margin.bottom})`);

                // labels
                svg
                .append("text")
                .attr("x", width / 2)
                .attr("y", margin.top / 2 - 10)
                .style("text-anchor", "middle")
                .style("font-size", "20px")
                .text(`Sales by Year for ${companyId}`);

                svg
                .append("text")
                .attr(
                    "transform",
                    "translate(" +
                    width / 2 +
                    "," +
                    (height - margin.bottom / 4) +
                    ")"
                )
                .style("text-anchor", "middle")
                .text("Year");

                svg
                .append("text")
                .attr(
                    "transform",
                    `translate(${margin.left / 2}, ${height / 2}) rotate(-90)`
                )
                .style("text-anchor", "middle")
                .text("Sales");
            }

            drawScatterPlot(nintendoData, "Nintendo");
            drawScatterPlot(sonyData, "Sony");
            drawScatterPlot(microsoftData, "Microsoft");
            });
        </script>
        
     </div>
     
      

    </div>

    <p>
        <svg id="contour" width="500" height="600"></svg>
            <script>
                const contour_svg = d3.select('#contour')
                const contour_width = contour_svg.attr('width')
                const contour_height = contour_svg.attr('height')
    
                const contour_margins = {top:20, right:20, left:50, bottom:100}
                const contour_plotwidth = contour_width - contour_margins.left - contour_margins.right
                const contour_plotheight = contour_height - contour_margins.top - contour_margins.bottom
                
                let contour_annotation = contour_svg.append('g').attr('id', 'contour_annotation')
                let contour_plotarea = contour_svg.append('g').attr("id", "contour_plotarea").attr('transform',"translate("+contour_margins.left+","+contour_margins.top+")")
    
                d3.csv("vgsales_clean.csv").then(function(contour_data) {
                    console.log(contour_data)
    
                    contour_data.forEach( (d, i) =>{
                        d['Global_Sales']=Number(d['Global_Sales'])
                        d['Year']=Number(d['Year'])
                    })
    
                    // Extents and scales
                    const gs_extent = d3.extent(contour_data, d=> d['Global_Sales'])
                    const gs_scale = d3.scaleLinear().domain(gs_extent).range([contour_plotheight,0])
                    
                    const year_extent = d3.extent(contour_data, d=> d['Year'])
                    const year_scale = d3.scaleLinear().domain(year_extent).range([0,contour_plotwidth])
    
                    const color_scale = d3.scaleLinear().domain([0,1]).range(["white", "blue"])
    
                    // Axises and gridlines
                    let contour_leftaxis = d3.axisLeft(gs_scale)
                    let contour_leftgridlines = d3.axisLeft(gs_scale).tickSize(-contour_plotwidth-20).tickFormat("")
                    
                    contour_annotation.append('g').attr('class', 'y axis').attr('transform', "translate("+(contour_margins.left-20)+","+(contour_margins.top)+")").call(contour_leftaxis)
                    contour_annotation.append('g').attr('class', 'y gridlines').attr('transform', "translate("+(contour_margins.left-20)+","+(contour_margins.top)+")").call(contour_leftgridlines)
    
    
                    let contour_bottomaxis = d3.axisBottom(year_scale)
                    let contour_bottomgridlines = d3.axisBottom(year_scale).tickSize(-contour_plotheight-20).tickFormat("")
                    
                    contour_annotation.append('g').attr('class', 'x axis').attr('transform', "translate("+(contour_margins.left)+","+(contour_plotheight+contour_margins.top+20)+")").call(contour_bottomaxis)
                    contour_annotation.append('g').attr('class', 'x gridlines').attr('transform', "translate("+(contour_margins.left)+","+(contour_plotheight+contour_margins.top+20)+")").call(contour_bottomgridlines)
    
                    // density
                    const density = d3.contourDensity().x(function(d) {return year_scale(d['Year'])}).y(function(d) {return gs_scale(d['Global_Sales'])}).size([contour_plotwidth, contour_plotheight]).bandwidth(5)(contour_data)
                    contour_svg.insert('g', 'g').selectAll('path').data(density).enter().append("path").attr("d", d3.geoPath()).attr('fill', function(d) { return color_scale(d.value)})
                })
            </script>
        </p>

  </body>
</html>
