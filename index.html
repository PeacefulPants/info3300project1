<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="main.js" type="text/javascript"></script>
    <style>
      .gridlines line {
        stroke: #000000;
      }

      .gridlines .domain {
        display: none;
      }

      .spinner circle {
        fill: none;
        stroke: #000000;
        stroke-width: 1.5px;
        stroke-dasharray: 283;
      }
    </style>
  </head>
  <body>
    <p>info 3300 project 1</p>
    <div id="visuals">
      <script>
        csvFile = "vgsales_clean.csv";
        d3.csv(csvFile).then(function (data) {
          const nintendoPlatforms = [
            "Wii",
            "NES",
            "GB",
            "DS",
            "SNES",
            "GBA",
            "3DS",
            "N64",
            "WiiU",
          ];
          const sonyPlatforms = [
            "PS3",
            "PS2",
            "PS4",
            "PS",
            "PSP",
            "PSV",
            "PSX",
          ];
          const microsoftPlatforms = ["X360", "XB", "XOne"];

          // filter data based on platforms
          const nintendoData = data.filter((d) =>
            nintendoPlatforms.includes(d.Platform)
          );
          const sonyData = data.filter((d) =>
            sonyPlatforms.includes(d.Platform)
          );
          const microsoftData = data.filter((d) =>
            microsoftPlatforms.includes(d.Platform)
          );

          // create a function to draw scatterplot
          function drawScatterPlot(data, companyId) {
            const width = 600;
            const height = 400;

            let svgContainer = d3.select("#visuals");
            let svg = svgContainer
              .append("svg")
              .attr("id", companyId)
              .attr("width", width)
              .attr("height", height);

            let margin = { top: 50, right: 30, bottom: 50, left: 60 };

            let xScale = d3
              .scaleLinear()
              .domain([1980, 2020])
              .range([margin.left, width - margin.right]);
            let yScale = d3
              .scaleLinear()
              .domain([0, d3.max(data, (d) => Number(d.Global_Sales))])
              .range([height - margin.bottom, margin.top]);

            // Color based on company
            let color;
            switch (companyId) {
              case "Nintendo":
                color = "#FFD1DC";
                break;
              case "Sony":
                color = "#B2D8D8";
                break;
              case "Microsoft":
                color = "#D8BFD8";
                break;
            }

            svg
              .selectAll("circle")
              .data(data)
              .join("circle")
              .attr("cx", (d) => xScale(+d.Year))
              .attr("cy", (d) => yScale(d.Global_Sales))
              .attr("r", (d) => 3)
              .style("fill", color);

            // axis
            svg
              .append("g")
              .call(d3.axisLeft(yScale))
              .attr("transform", `translate(${margin.left},0)`);

            svg
              .append("g")
              .call(d3.axisBottom(xScale).tickFormat((d) => `${d}`))
              .attr("transform", `translate(0,${height - margin.bottom})`);

            // labels
            svg
              .append("text")
              .attr("x", width / 2)
              .attr("y", margin.top / 2 - 10)
              .style("text-anchor", "middle")
              .style("font-size", "20px")
              .text(`Sales by Year for ${companyId}`);

            svg
              .append("text")
              .attr(
                "transform",
                "translate(" +
                  width / 2 +
                  "," +
                  (height - margin.bottom / 4) +
                  ")"
              )
              .style("text-anchor", "middle")
              .text("Year");

            svg
              .append("text")
              .attr(
                "transform",
                `translate(${margin.left / 2}, ${height / 2}) rotate(-90)`
              )
              .style("text-anchor", "middle")
              .text("Sales");
          }

          drawScatterPlot(nintendoData, "Nintendo");
          drawScatterPlot(sonyData, "Sony");
          drawScatterPlot(microsoftData, "Microsoft");
        });
      </script>
    </div>
  </body>
</html>
